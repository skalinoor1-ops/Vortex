<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleek Studio - AI Web Builder</title>
    <style>
        :root {
            --bg: #ffffff;
            --surface: #f5f5f7;
            --border: #e5e5ea;
            --text: #1d1d1f;
            --text-light: #86868b;
            --accent: #000000;
            --blue: #0071e3;
            --red: #ff3b30;
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font); outline: none; }

        body {
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- SVG SYMBOLS --- */
        .svg-sprite { display: none; }

        /* --- NAV --- */
        nav {
            height: 64px;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            z-index: 50;
            flex-shrink: 0;
        }

        .brand {
            font-weight: 700;
            font-size: 1.4rem;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .tabs {
            display: flex;
            background: var(--surface);
            padding: 4px;
            border-radius: 20px;
            gap: 5px;
        }

        .tab-btn {
            padding: 6px 16px;
            border-radius: 16px;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-light);
            cursor: pointer;
            transition: 0.2s;
        }

        .tab-btn.active {
            background: #fff;
            color: var(--text);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* --- VIEW CONTAINER --- */
        .view-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            overflow-y: auto; /* ENABLE SCROLLING */
            padding: 0;
            background: var(--bg);
        }
        .view.active { display: flex; z-index: 10; }

        /* --- CREATE VIEW --- */
        .create-content {
            padding: 40px 20px 80px 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .hero { text-align: center; animation: fadeUp 0.6s ease; }
        h1 { font-size: 3rem; font-weight: 800; letter-spacing: -1.5px; margin-bottom: 10px; }
        p.sub { color: var(--text-light); font-size: 1.1rem; }

        .input-box {
            position: relative;
            width: 100%;
        }

        textarea {
            width: 100%; height: 140px; padding: 20px;
            border: 1px solid var(--border); border-radius: 24px;
            background: var(--surface); font-size: 1.1rem; resize: none;
            transition: 0.2s;
            box-shadow: 0 4px 20px rgba(0,0,0,0.02);
        }
        textarea:focus { border-color: var(--accent); background: #fff; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }

        .btn-gen {
            position: absolute; bottom: 15px; right: 15px;
            background: var(--accent); color: white; border: none;
            padding: 10px 24px; border-radius: 30px; font-weight: 600;
            cursor: pointer; transition: transform 0.1s;
        }
        .btn-gen:active { transform: scale(0.95); }

        /* --- TEMPLATES SECTION --- */
        .templates-area {
            animation: fadeUp 0.8s ease;
        }
        .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 20px; color: var(--text-light); }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
        }

        .card {
            background: #fff; border: 1px solid var(--border);
            border-radius: 18px; padding: 20px;
            cursor: pointer; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; text-align: center; gap: 10px;
        }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .card svg { width: 32px; height: 32px; fill: var(--text); }
        .card span { font-weight: 500; font-size: 0.95rem; }

        /* --- LIBRARY VIEW --- */
        .library-content {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .project-card {
            background: #fff; border: 1px solid var(--border);
            border-radius: 20px; padding: 20px;
            transition: 0.2s; display: flex; flex-direction: column; gap: 15px;
        }
        .project-card:hover { border-color: var(--text-light); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }

        .proj-name { font-weight: 600; font-size: 1.1rem; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .proj-date { font-size: 0.8rem; color: var(--text-light); }
        
        .card-actions { display: flex; gap: 10px; margin-top: auto; }
        .action-btn {
            flex: 1; padding: 10px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--surface); cursor: pointer; font-size: 0.9rem; font-weight: 500;
            transition: 0.2s; text-align: center;
        }
        .action-btn:hover { background: #e5e5e5; }
        .action-btn.del { color: var(--red); }
        .action-btn.del:hover { background: #fff2f1; border-color: #ffcccc; }

        /* --- PREVIEW VIEW --- */
        #view-preview { padding: 0; background: #fff; z-index: 20; }
        
        .preview-bar {
            height: 60px; 
            background: #fff; 
            border-bottom: 1px solid var(--border);
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0 20px;
            flex-shrink: 0;
            position: relative;
            z-index: 30; /* Ensure bar is above iframe */
        }
        
        .back-btn {
            display: flex; align-items: center; gap: 5px;
            background: var(--surface); border: 1px solid var(--border);
            padding: 8px 16px; border-radius: 10px; cursor: pointer;
            font-weight: 600; font-size: 0.9rem;
            color: var(--text);
        }
        .back-btn:hover { background: #e0e0e0; }

        iframe { 
            flex: 1; 
            border: none; 
            background: white; 
            width: 100%; 
            height: 100%;
            display: block;
        }

        /* --- LOADING OVERLAY --- */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 200; display: none;
            flex-direction: column; align-items: center; justify-content: center;
        }

        .sleek-spinner {
            width: 50px; height: 50px; border: 4px solid var(--surface);
            border-top: 4px solid var(--accent); border-radius: 50%;
            animation: spin 0.8s infinite linear;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeUp { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }

        /* --- CHAT OVERLAY --- */
        #payment-chat {
            position: fixed; bottom: 20px; right: 20px; width: 320px;
            background: #fff; border: 1px solid var(--border); border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); padding: 20px;
            display: none; flex-direction: column; z-index: 300;
        }

    </style>
</head>
<body>

    <svg class="svg-sprite">
        <symbol id="icon-layer" viewBox="0 0 24 24"><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"/></symbol>
        <symbol id="icon-brush" viewBox="0 0 24 24"><path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"/></symbol>
        <symbol id="icon-shop" viewBox="0 0 24 24"><path d="M20 4H4v2h16V4zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6h1zm-9 4H6v-4h6v4z"/></symbol>
        <symbol id="icon-code" viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></symbol>
        <symbol id="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></symbol>
        <symbol id="icon-download" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></symbol>
    </svg>

    <nav>
        <div class="brand" onclick="switchTab('create')">
            <svg style="width:24px;height:24px;fill:black"><use href="#icon-layer"/></svg>
            Sleek
        </div>
        <div class="tabs">
            <button class="tab-btn active" id="btn-create" onclick="switchTab('create')">Create</button>
            <button class="tab-btn" id="btn-library" onclick="switchTab('library')">Library</button>
        </div>
    </nav>

    <div class="view-container">
        
        <div id="view-create" class="view active">
            <div class="create-content">
                <div class="hero">
                    <h1>What will we build?</h1>
                    <p class="sub">Welcome to sleek your best friend that creates websites for free wanna try?</p>
                </div>
                
                <div class="input-box">
                    <textarea id="prompt" placeholder="Describe your idea (e.g. 'A futuristic gaming clan website')..."></textarea>
                    <button class="btn-gen" onclick="generate()">Generate</button>
                </div>

                <div class="templates-area">
                    <div class="section-title">Quick Start Templates</div>
                    <div class="grid">
                        <div class="card" onclick="fill('Brand Logo Generator tool with SVG export')">
                            <svg><use href="#icon-brush"/></svg>
                            <span>Logo Builder</span>
                        </div>
                        <div class="card" onclick="fill('E-commerce store with product grid and cart')">
                            <svg><use href="#icon-shop"/></svg>
                            <span>E-Commerce</span>
                        </div>
                        <div class="card" onclick="fill('SaaS Landing Page with pricing table')">
                            <svg><use href="#icon-layer"/></svg>
                            <span>Landing Page</span>
                        </div>
                        <div class="card" onclick="fill('Developer Portfolio with dark mode')">
                            <svg><use href="#icon-code"/></svg>
                            <span>Portfolio</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-library" class="view">
            <div class="library-content">
                <h2 style="margin-bottom:30px;">Saved Projects</h2>
                <div class="library-grid" id="library-list">
                    </div>
            </div>
        </div>

        <div id="view-preview" class="view">
            <div class="preview-bar">
                <button class="back-btn" onclick="exitPreview()">
                    <svg style="width:18px;height:18px;fill:currentColor"><use href="#icon-back"/></svg>
                    Back
                </button>
                <span id="preview-title" style="font-size:0.9rem; font-weight:600; color:#333;">Untitled</span>
                <button class="back-btn" style="background:black; color:white; border-color:black;" onclick="downloadCurrent()">
                    <svg style="width:18px;height:18px;fill:currentColor;margin-right:5px;"><use href="#icon-download"/></svg>
                    Download
                </button>
            </div>
            <iframe id="site-frame"></iframe>
        </div>

    </div>

    <div id="loading-overlay">
        <div class="sleek-spinner"></div>
        <h3 style="margin-top:20px; font-weight:500;">Designing...</h3>
    </div>

    <div id="payment-chat">
        <p style="font-size:0.9rem; margin-bottom:10px;"><strong>Sleek AI:</strong> I see you need payments. Enter your Public Key below:</p>
        <input type="text" id="pay-key" placeholder="Paste key..." onkeydown="if(event.key==='Enter') submitPayKey(this.value)" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
    </div>

    <script>
        // ==========================================
        // ⚙️ CONFIGURATION
        // ==========================================
        
        // 1. PASTE YOUR ENCODED KEY HERE (From base64encode.org)
        const _ENC_KEY = "c2stb3ItdjEtZWZjZTQ1NzYxYTljYzUwNjhiNzE0MjFiOGQ2YzhkYWMwNWMyMTBkYmVjM2I5NTA3YjMyNDk1NTUzNzhlZjJlNg=="; 
        
        const MODEL = "kwaipilot/kat-coder-pro:free";

        // ==========================================

        let currentCode = "";
        let projects = JSON.parse(localStorage.getItem('sleek_projects') || "[]");

        // --- TAB LOGIC ---
        function switchTab(tab) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            if(tab === 'create') {
                document.getElementById('view-create').classList.add('active');
                document.getElementById('btn-create').classList.add('active');
            } else if (tab === 'library') {
                renderLibrary();
                document.getElementById('view-library').classList.add('active');
                document.getElementById('btn-library').classList.add('active');
            }
        }

        function fill(text) {
            document.getElementById('prompt').value = text;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function exitPreview() {
            // Logic: If user has many projects, assume they want library. If 0 (just made one), maybe create.
            // Safest: Go to Library if populated.
            document.getElementById('site-frame').src = "about:blank"; // Clear iframe
            
            if(projects.length > 0) {
                switchTab('library');
            } else {
                switchTab('create');
            }
        }

        // --- GENERATION ---
        async function generate() {
            const promptVal = document.getElementById('prompt').value;
            if(!promptVal) return alert("Please enter a description!");

            // Payment Check
            if(promptVal.toLowerCase().includes("payment") || promptVal.toLowerCase().includes("money")) {
                document.getElementById('payment-chat').style.display = 'flex';
                return;
            }

            executeAI(promptVal);
        }

        function submitPayKey(key) {
            document.getElementById('payment-chat').style.display = 'none';
            const original = document.getElementById('prompt').value;
            executeAI(original + ` . Note: Use this Payment Key: ${key}`);
        }

        async function executeAI(finalPrompt) {
            let realKey = "";
            try { realKey = atob(_ENC_KEY); } catch(e) { }
            
            if(!realKey || realKey.includes("PASTE")) {
                alert("Please paste your encoded API Key in the code (Line 207).");
                return;
            }

            document.getElementById('loading-overlay').style.display = 'flex';

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${realKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": "https://sleek.studio",
                        "X-Title": "Sleek"
                    },
                    body: JSON.stringify({
                        "model": MODEL,
                        "messages": [
                            {"role": "system", "content": "You are Sleek AI. Generate single-file HTML/CSS/JS. No markdown. High quality design. If asked for a logo builder, create an SVG editor."},
                            {"role": "user", "content": finalPrompt}
                        ]
                    })
                });

                const data = await res.json();
                if(data.error) throw new Error(data.error.message);

                let rawCode = data.choices[0].message.content.replace(/```html/g, '').replace(/```/g, '');
                currentCode = rawCode; // Store globally for download

                saveProject(finalPrompt, rawCode);
                
                document.getElementById('loading-overlay').style.display = 'none';
                openPreview(finalPrompt, rawCode);

            } catch (err) {
                document.getElementById('loading-overlay').style.display = 'none';
                alert("Error: " + err.message);
            }
        }

        // --- LIBRARY SYSTEM ---
        function saveProject(name, code) {
            const newProj = {
                id: Date.now(),
                name: name.substring(0, 30) + (name.length>30?"...":""),
                date: new Date().toLocaleDateString(),
                code: code
            };
            projects.unshift(newProj);
            localStorage.setItem('sleek_projects', JSON.stringify(projects));
        }

        function renderLibrary() {
            const list = document.getElementById('library-list');
            list.innerHTML = "";

            if(projects.length === 0) {
                list.innerHTML = "<p style='color:#aaa; text-align:center; grid-column:1/-1; padding-top:40px;'>No projects yet. Go create one!</p>";
                return;
            }

            projects.forEach(p => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <div class="proj-name">${p.name}</div>
                    <div class="proj-date">Created: ${p.date}</div>
                    <div class="card-actions">
                        <button class="action-btn" onclick="loadProject(${p.id})">Open</button>
                        <button class="action-btn del" onclick="deleteProject(${p.id})">Delete</button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function loadProject(id) {
            const p = projects.find(x => x.id === id);
            if(p) {
                openPreview(p.name, p.code);
            }
        }

        function deleteProject(id) {
            if(!confirm("Delete this project?")) return;
            projects = projects.filter(x => x.id !== id);
            localStorage.setItem('sleek_projects', JSON.stringify(projects));
            renderLibrary();
        }

        // --- PREVIEW ---
        function openPreview(title, code) {
            // 1. Set global code for download
            currentCode = code; 

            // 2. Hide all other views
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            
            // 3. Show Preview
            const previewView = document.getElementById('view-preview');
            previewView.classList.add('active'); 
            
            document.getElementById('preview-title').innerText = title;
            
            // 4. Render Iframe
            const doc = document.getElementById('site-frame').contentWindow.document;
            doc.open();
            doc.write(code);
            doc.close();
        }

        function downloadCurrent() {
            if (!currentCode) {
                alert("No code to download!");
                return;
            }
            const blob = new Blob([currentCode], {type: "text/html"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "sleek-website.html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
